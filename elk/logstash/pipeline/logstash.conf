# elk/logstash/pipeline/logstash.conf
input {
  beats {
    port => 5044
  }
}

filter {
  # FastAPI 应用生成的日志已经是 JSON 格式了。
  # 'message' 字段包含了整个 JSON 字符串。
  # json 过滤器会解析这个字段，并将其中的键值对提升为日志事件的顶级字段。
  json {
    source => "message"
  }
}

output {
  elasticsearch {
    hosts => ["http://elasticsearch:9200"]
    index => "fastapi-%{+YYYY.MM.dd}"
  }
}